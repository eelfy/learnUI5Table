<html><head></head><body><div id="d4h5-main-container" class="dk-main"><section id="loio0219b115deda45a9ae46d11fdc7e69eb" class=" section topic"><h1 class="collapsible-icon sap-icon innerTitle">Step 9: Smart Chart with Chart Personalization and View Management</h1><div class="fig"><h1 class="topictitle1 title">Step 9: Smart Chart with Chart Personalization and View Management</h1><div class="shortdesc">In this step, we will look at the SmartChart control with the chart
		personalization and in combination with the VariantManagement control that
		allow you to use complex graphics along with other smart control features.</div><p>The <code>SmartChart</code> control can be used for visualizing data in a graphical manner.
			The <code>SmartChart</code> control creates a chart based on OData metadata and the
			configuration data that has been specified. The <code>entitySet</code> property must
			be specified to use the control. This property is used to fetch fields from OData
			metadata, from which the chart UI is generated.</p><p>There are several features that can be enabled in <code>SmartChart</code>, but for this
			tutorial, we will have a look at the following features:</p><ul class="ul ">
			<li class="li">
				<p>Chart personalization</p>
			</li>
			<li class="li">
				<p>View management support</p>
			</li>
			<li class="li">
				<p>Semantic object navigation using <code>SemanticObjectController</code></p>
			</li>
		</ul><section>
			<h2 class="title ">Preview</h2>
			<p>This is what the smart chart looks like initially after firing the query:</p>
			<div><div class="fig"><img src="loio935f9ed2eaeb470e9a097a4e18f61146_HiRes.png" usemap="#"></div><span class="collapsible-icon sap-icon figcap title">Initial Look of Smart Chart after Firing Query</span></div>
			<p>The toolbar of the smart chart contains the header, and next to it is the view management
				dialog that has been explained in detail in one of the previous steps. </p>
			<p>Next to the view management dialog is a button labeled <span class="ph uicontrol">Jump To</span>. This
				button is disabled by default, but once a column has been selected inside the chart,
				this button gets enabled. When we click this button, a popup appears that contains
				details of the selected column. You can also navigate to related apps from here.
				This feature is enabled using <code>SemanticObjectController</code>. When we
				hover the mouse pointer over a column, a popup is displayed to provide additional
				information.</p>
			
			<div><div class="fig"><img src="loio77403c9e03b646e98ca9d5d5b2012bec_HiRes.png" usemap="#"></div><span class="collapsible-icon sap-icon figcap title">Semantic Navigation Feature</span></div>
			<p>The button at the right-hand side of the toolbar can be used for selecting the chart
				type:</p>
			<div><div class="fig"><img src="loiod54fb32489224d9b92be1cb07093df1c_HiRes.png" usemap="#"></div><span class="collapsible-icon sap-icon figcap title">Selection of Chart Type</span></div>
			<p>The two buttons next to the <span class="ph uicontrol">Jump To</span> button can be used to
				drill up and drill down into the chart. Using this feature you can display even more
				detailed information in the chart: </p>
			<div><div class="fig"><img src="loio8679d394653e4e928a57992f1a3a92b7_HiRes.png" usemap="#"></div><span class="collapsible-icon sap-icon figcap title">Drillup and Drilldown Features</span></div>
			<p>If we set the <code>showDetailsButton</code> and <code>showDrillBreadcrumbs</code>
				properties to <code>true</code>, we can also use an alternative drilldown
				function: A button labeled <span class="ph uicontrol">Drilldown</span> is shown. If a column is
				selected inside the chart, this button changes into a <span class="ph uicontrol">Details</span>
				button. When you click this button, again, a popup appears that contains details of
				the selected column. </p>
			<div><div class="fig"><img src="loio63fed30c0b6946cb911256289874badb_HiRes.png" usemap="#"></div><span class="collapsible-icon sap-icon figcap title">Drilldown by Dimensions</span></div>
			<p>When you drill further down, you can see the breadcrumbs trail for the drilldown path
				on the left-hand side, which you can also use to drill up within the chart.</p>
			<div><div class="fig"><img src="loio7eb0305debea4f8b80bf77e9d8d85e8a_HiRes.png" usemap="#"></div><span class="collapsible-icon sap-icon figcap title">Further Drilldown</span></div>
			<p>The next button can be used to toggle legend visibility:</p>
			<div><div class="fig"><img src="loio3e8568e8da664246aa1699ed572639e5_HiRes.png" usemap="#"></div><span class="collapsible-icon sap-icon figcap title">Toggle Legend Visibility</span></div>
			<p>The two buttons next to this in the toolbar are used for zooming in or out. This will
				help you to get a clearer picture of a particular entity. The next button in the
				toolbar is the <span class="ph uicontrol">Settings</span> icon that opens the personalization
				dialog for the chart:</p>
			<div><div class="fig"><img src="loio18889d26d5b242f4a0d17946e86ff3bc_HiRes.png" usemap="#"></div><span class="collapsible-icon sap-icon figcap title">Dialog for Adding Measures and Dimensions</span></div>
			<p>The button next to the settings can be used to display a chart in full screen mode.
				The chart will then take up 100 % width and height of the browser.</p>
		</section><section>
			<h2 class="title ">Coding</h2>
			<p>You can view and download all files in the <span class="ph uicontrol">Samples</span> in the Demo Kit at <a href="#/sample/sap.ui.comp.tutorial.smartControls.09/preview" title="#/sample/sap.ui.comp.tutorial.smartControls.09/preview" class="sap-doc" alt="#/sample/sap.ui.comp.tutorial.smartControls.09/preview">Smart Controls - Step 9 - Smart
					Chart</a> and at <a href="#/entity/sap.ui.comp.smartchart.SmartChart" title="#/entity/sap.ui.comp.smartchart.SmartChart" class="sap-doc" alt="#/entity/sap.ui.comp.smartchart.SmartChart">Samples</a>.</p>
		</section><section>
			<h2 class="title ">SmartChart.view.xml</h2>
			
			<section class="lang-xml"><div class="fig fig-codeblock"><pre class="codeblock prettyprint">&lt;mvc:View xmlns="sap.m" xmlns:mvc="sap.ui.core.mvc"
	xmlns:html="http://www.w3.org/1999/xhtml"
	xmlns:app="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1"
	controllerName="sap.ui.demo.smartControls.SmartChart" xmlns:sl="sap.ui.comp.navpopover"
	xmlns:smartChart="sap.ui.comp.smartchart"&gt;
	&lt;smartChart:SmartChart enableAutoBinding="true"
		entitySet="Products" useVariantManagement="true"
		persistencyKey="SmartChart_Explored" useChartPersonalisation="true"
		header="Products"&gt;
		&lt;smartChart:semanticObjectController&gt;
			&lt;sl:SemanticObjectController
				navigationTargetsObtained="onNavigationTargetsObtained" navigate="onNavigate" /&gt;
		&lt;/smartChart:semanticObjectController&gt;
	&lt;/smartChart:SmartChart&gt;
&lt;/mvc:View&gt;
</pre></div></section>
			<p>We see that a new control has been added to the <code>view.xml</code>. In the
					<code>SmartChart</code> control, we refer to the entity type that we will
				see later in the <code>metadata.xml</code>. With
					<code>SemanticObjectController</code> that is added to the
					<code>semanticObjectController</code> aggregation of
					<code>SmartChart</code>, we can enable the display of linked data for a
				particular entity. We also set <code>enableAutoBinding=”true”</code>, which
				enables automatic execution of the query and thus shows the result as soon as the
					<code>SmartChart</code> control is loaded. We set
					<code>useVariantManagement=”true”</code> and
					<code>persistencyKey=”SmartChart_Explored”</code> to enable the view
				management. We also set <code>useChartPersonalisation=”true”</code>, which
				enables the chart personalization.</p>
		</section><section>
			<h2 class="title ">SmartChart.controller.js</h2>
			
			<section class="lang-js"><div class="fig fig-codeblock"><pre class="codeblock prettyprint">sap.ui.define([
	"sap/ui/core/mvc/Controller",
	"sap/m/MessageBox"
], function(Controller, MessageBox) {
	"use strict";

	return Controller.extend("sap.ui.demo.smartControls.SmartChart", {
		onNavigationTargetsObtained: function(oEvent) {
			var oParameters = oEvent.getParameters();
			var oSemanticAttributes = oParameters.semanticAttributes;

			oParameters.show("Supplier", new sap.ui.comp.navpopover.LinkData({
				text: "Homepage",
				href: "http://www.sap.com",
				target: "_blank"
			}), [
				new sap.ui.comp.navpopover.LinkData({
					text: "Go to shopping cart"
				})
			], new sap.ui.layout.form.SimpleForm({
				maxContainerCols: 1,
				content: [
					new sap.ui.core.Title({
						text: "Product description"
					}), new sap.m.Image({
						src: "img/HT-1052.jpg", //oSemanticAttributes.ProductPicUrl,
						densityAware: false,
						width: "50px",
						height: "50px",
						layoutData: new sap.m.FlexItemData({
							growFactor: 1
						})
					}), new sap.m.Text({
						text: oSemanticAttributes.Description
					})
				]
			}));
		},

		onNavigate: function(oEvent) {
			var oParameters = oEvent.getParameters();
			if (oParameters.text === "Homepage") {
				return;
			}
			MessageBox.show(oParameters.text + " has been pressed", {
				icon: sap.m.MessageBox.Icon.INFORMATION,
				title: "SmartChart demo",
				actions: [
					sap.m.MessageBox.Action.OK
				]
			});
		}
	});

});
</pre></div></section>
			<p>The following two functions are defined:</p>
			<ul class="ul ">
				<li class="li">
					<p><code>onNavigationTargetObtained()</code></p>
				</li>
				<li class="li">
					<p><code>onNavigate()</code></p>
				</li>
			</ul>
			<p>
				<code>onNavigationTargetObtained()</code> is called when a column is selected
				and you click the <span class="ph uicontrol">Jump To</span> button. With the
				click
				event the semantic parameters are obtained, and the function renders a navigation
				popover containing a simple form that presents detailed information of the entity
				selected as can be seen in figure 2.</p>
			<p><code>onNavigate()</code> is called when the links in the navigation popover are clicked.
				This
				is done to demonstrate how you add more functionality to the data in the navigation
				popover. In our example, we are just showing a message box and
				the navigation to one other link.</p>
		</section><section>
			<h2 class="title ">metadata.xml</h2>
			
			<section class="lang-xml"><div class="fig fig-codeblock"><pre class="codeblock prettyprint">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;edmx:Edmx Version="1.0"
	xmlns:edmx="http://schemas.microsoft.com/ado/2007/06/edmx"
	xmlns:m="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata"
	xmlns:sap="http://www.sap.com/Protocols/SAPData"&gt;
	&lt;edmx:Reference
		xmlns:edmx="http://docs.oasis-open.org/odata/ns/edmx"&gt;
		&lt;edmx:Include Namespace="com.sap.vocabularies.Common.v1"
			Alias="Common" /&gt;
	&lt;/edmx:Reference&gt;
	&lt;edmx:Reference
		xmlns:edmx="http://docs.oasis-open.org/odata/ns/edmx"&gt;
		&lt;edmx:Include Namespace="com.sap.vocabularies.UI.v1"
			Alias="UI" /&gt;
	&lt;/edmx:Reference&gt;
	&lt;edmx:DataServices m:DataServiceVersion="2.0"&gt;
		&lt;Schema Namespace="com.sap.wt08"
			sap:schema-version="0" xmlns="http://schemas.microsoft.com/ado/2008/09/edm"&gt;
			&lt;EntityType Name="Product" sap:service-schema-version="1"
				sap:service-version="1" sap:semantics="aggregate"
				sap:content-version="1"&gt;
				&lt;Key&gt;
					&lt;PropertyRef Name="ProductId" /&gt;
				&lt;/Key&gt;
				&lt;Property Name="ProductId" Type="Edm.String" Nullable="false"
					MaxLength="10" sap:aggregation-role="dimension" sap:label="Product ID"
					sap:creatable="false" sap:updatable="false" sap:sortable="true"
					sap:filterable="true" /&gt;
				&lt;Property Name="Category" Type="Edm.String" Nullable="false"
					MaxLength="40" sap:aggregation-role="dimension" sap:label="Product Category"
					sap:creatable="false" sap:updatable="false" sap:sortable="true"
					sap:filterable="true" /&gt;
				&lt;Property Name="Name" Type="Edm.String" Nullable="false"
					MaxLength="255" sap:aggregation-role="dimension" sap:label="Name"
					sap:creatable="false" sap:updatable="false" sap:sortable="true"
					sap:filterable="true" /&gt;
				&lt;Property Name="Description" Type="Edm.String" Nullable="false"
					MaxLength="255" sap:aggregation-role="dimension" sap:label="Description"
					sap:creatable="false" sap:updatable="false" sap:sortable="true"
					sap:filterable="true" /&gt;
				&lt;Property Name="SupplierName" Type="Edm.String" Nullable="false"
					MaxLength="80" sap:aggregation-role="dimension" sap:label="Company Name"
					sap:creatable="false" sap:updatable="false" sap:sortable="true"
					sap:filterable="true" /&gt;
				&lt;Property Name="Quantity" Type="Edm.Decimal" Nullable="false"
					MaxLength="3" sap:aggregation-role="measure" sap:label="Quantity"
					sap:creatable="false" sap:updatable="false" sap:sortable="true"
					sap:filterable="true" /&gt;
				&lt;Property Name="Price" Type="Edm.Decimal" Nullable="false"
					Precision="23" Scale="4" sap:aggregation-role="measure" sap:label="Price"
					sap:creatable="false" sap:updatable="false" sap:sortable="true"
					sap:filterable="true" /&gt;
				&lt;Property Name="CurrencyCode" Type="Edm.String" Nullable="false"
					MaxLength="5" sap:aggregation-role="dimension" sap:label="Currency Code"
					sap:creatable="false" sap:updatable="false" sap:sortable="true"
					sap:filterable="true" /&gt;
			&lt;/EntityType&gt;
			&lt;EntityContainer Name="com.sap.wt08"
				m:IsDefaultEntityContainer="true"&gt;
				&lt;EntitySet Name="Products" EntityType="com.sap.wt08.Product"
					sap:creatable="false" sap:updatable="false" sap:deletable="false"
					sap:pageable="false" sap:content-version="1" /&gt;
			&lt;/EntityContainer&gt;
			&lt;Annotations Target="com.sap.wt08.Product"
				xmlns="http://docs.oasis-open.org/odata/ns/edm"&gt;
				&lt;Annotation Term="com.sap.vocabularies.UI.v1.LineItem"&gt;
					&lt;Collection&gt;
						&lt;Record Type="com.sap.vocabularies.UI.v1.DataField"&gt;
							&lt;PropertyValue Property="Value" Path="Name" /&gt;
							&lt;Annotation Term="com.sap.vocabularies.UI.v1.Importance"
								EnumMember="com.sap.vocabularies.UI.v1.ImportanceType/High" /&gt;
						&lt;/Record&gt;
						&lt;Record Type="com.sap.vocabularies.UI.v1.DataField"&gt;
							&lt;PropertyValue Property="Value" Path="Category" /&gt;
							&lt;Annotation Term="com.sap.vocabularies.UI.v1.Importance"
								EnumMember="com.sap.vocabularies.UI.v1.ImportanceType/High" /&gt;
						&lt;/Record&gt;
					&lt;/Collection&gt;
				&lt;/Annotation&gt;
			&lt;/Annotations&gt;
			&lt;Annotations Target="com.sap.wt08.Product"
				xmlns="http://docs.oasis-open.org/odata/ns/edm"&gt;
				&lt;Annotation Term="com.sap.vocabularies.UI.v1.Chart"&gt;
					&lt;Record&gt;
						&lt;PropertyValue Property="Title" String="Line Items" /&gt;
						&lt;PropertyValue Property="ChartType"
							EnumMember="com.sap.vocabularies.UI.v1.ChartType/Column" /&gt;
						&lt;PropertyValue Property="Dimensions"&gt;
							&lt;Collection&gt;
								&lt;PropertyPath&gt;Name&lt;/PropertyPath&gt;
								&lt;PropertyPath&gt;Category&lt;/PropertyPath&gt;
							&lt;/Collection&gt;
						&lt;/PropertyValue&gt;
						&lt;PropertyValue Property="Measures"&gt;
							&lt;Collection&gt;
								&lt;PropertyPath&gt;Price&lt;/PropertyPath&gt;
								&lt;PropertyPath&gt;Quantity&lt;/PropertyPath&gt;
							&lt;/Collection&gt;
						&lt;/PropertyValue&gt;
					&lt;/Record&gt;
				&lt;/Annotation&gt;
			&lt;/Annotations&gt;
			&lt;Annotations Target="com.sap.wt08.Product/Category"
				xmlns="http://docs.oasis-open.org/odata/ns/edm"&gt;
				&lt;Annotation Term="com.sap.vocabularies.Common.v1.SemanticObject"
					String="SemanticObjectCategory" /&gt;
			&lt;/Annotations&gt;
		&lt;/Schema&gt;
	&lt;/edmx:DataServices&gt;
&lt;/edmx:Edmx&gt;
</pre></div></section>
			<p>The most important point to keep in mind is that analytical annotations along with
				chart annotations need to exist in the <code>metadata.xml</code>. The most
				prominent annotations are listed below:</p>
			<ul class="ul ">
				<li class="li">
					<p><code>sap:semantics="aggregate"</code></p>
					<p>An analytical operation can be performed on the data. This has to be added to
							<code>EntityType</code> (in our case “Product”)</p>
				</li>
				<li class="li">
					<p><code>sap:aggregation-role="dimension"</code></p>
					<p>Defines that a property of <code>EntityType</code> is treated as a
						dimension.</p>
				</li>
				<li class="li">
					<p><code>sap:aggregation-role="measure"</code></p>
					<p>Defines that a property of <code>EntityType</code> is treated as a
						measure.</p>
				</li>
				<li class="li">
					<p>
						<code>Annotation Term="com.sap.vocabularies.UI.v1.Chart</code></p>
					<p>Defines the UI annotation for rendering a chart.</p>
				</li>
				<li class="li">
					<p><code>EnumMember="com.sap.vocabularies.UI.v1.ChartType/Column"</code></p>
					<p>Defines the default chart type.</p>
				</li>
				<li class="li">
					<p><code>Annotation Term="com.sap.vocabularies.Common.v1.SemanticObject"</code></p>
					<p>Defines the <code>SemanticObject</code> annotation for
							<code>EntityType</code> (in our case the product category).</p>
				</li>
			</ul>
		</section><section>
			<h2 class="title ">Products.json</h2>
			
			<section class="lang-js"><div class="fig fig-codeblock"><pre class="codeblock prettyprint">[
  {
	"ProductId": "1239102",
	"Name": "Power Projector 4713",
	"Category": "Projector",
	"SupplierName": "Titanium",
	"Description": "A very powerful projector with special features for Internet usability, USB",
	"WeightMeasure": 1467,
	"WeightUnit": "g",
	"Price": 856.49,
	"CurrencyCode": "EUR",
	"Status": "Available",
	"Quantity": 3,
	"UoM": "PC",
	"Width": 51,
	"Depth": 42,
	"Height": 18,
	"DimUnit": "cm"
  },
.
.
.
]
</pre></div></section>
			<p>We have only listed a part of the <code>Products.json</code> entries since the actual
				values are not so relevant. Please note that for your convenience we have included
				additional properties in this file to make it easier to experiment with changes of
				the <code>metadata.xml</code>, and possibly of the <code>view.xml</code>, to
				allow for a more hands-on experience.</p>
		</section><section class="contentInSection hidden"><h2>In this section:</h2></section><section class="familyLinks"><div class="parentLink"><br><strong>Parent topic: </strong><a href="topic/64bde9a8879d4f418e2849f7285dd757">Smart Controls</a></div><div class="previousLink"><br><strong>Previous: </strong><a href="topic/b1d4d261524b4a3da78547ed4283a082">Step 8: Page Variant Management</a></div><div class="nextLink"><br><strong>Next: </strong><a href="topic/ec59a200c9dc482e995da6c7c892999f">Summary</a></div></section><section class="hidden relatedLinks "><div class="collapsible-icon sap-icon title"><h2>Related information</h2></div><ul class="fig"></ul></section></div></section></div></body></html>