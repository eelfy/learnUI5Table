/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/documentation/sdk/controller/BaseController","sap/ui/documentation/sdk/controller/util/SearchUtil","sap/ui/documentation/sdk/controller/util/Highlighter","sap/ui/model/json/JSONModel","sap/m/GroupHeaderListItem","sap/base/Log"],function(q,B,S,H,J,G,L){"use strict";return B.extend("sap.ui.documentation.sdk.controller.SearchPage",{onInit:function(){this.setModel(new J());this.bindListResults();this.getRouter().getRoute("search").attachPatternMatched(this._onTopicMatched,this);},bindListResults:function(){this.dataObject={data:[]};this.getModel().setData(this.dataObject);},onAfterRendering:function(){var c={useExternalStyles:false,shouldBeObserved:true,isCaseSensitive:false};if(!this.highlighter){this.highlighter=new H(this.getView().getDomRef(),c);}},onExit:function(){this.highlighter.destroy();},_onTopicMatched:function(a){var Q=decodeURIComponent(a.getParameter("arguments").searchParam),o=a.getParameter("arguments")["?options"],c=o&&o.category,l=this.byId("allList"),s=this._findSectionForCategory(c),b=s?s.getId():null,O=this.getModel().getProperty("/searchTerm"),p='';try{this.hideMasterSide();}catch(e){L.error(e);}if(Q===O){this.getView().byId("searchPage").setSelectedSection(b);return;}this.getModel().setProperty("/searchTerm",Q);this._modelRefresh();l.setBusy(true);S.search(Q).then(function(r){this.dataObject=r.matches;this.dataObject.searchTerm=Q;this.getModel().setData(this.dataObject);this.getView().byId("searchPage").setSelectedSection(b);l.setBusy(false);}.bind(this));if(this.highlighter){this.highlighter.highlight(Q);}p=this.getModel("i18n").getResourceBundle().getText("SEARCH_PAGE_TITLE",[Q]);this.appendPageTitle(p);},formatTableTitle:function(p,v,i){var V=i>0?"1 - "+v:"0";return this.formatMessage(p,V,i);},_findSectionForCategory:function(c){var s=this.getView().byId("searchPage").getSections().filter(function(o){return(o.data("category")==c);});return s.length&&s[0];},_modifyLinks:function(){var v=this.getView(),i=[].concat(v.byId("allList").getItems(),v.byId("apiList").getItems(),v.byId("documentationList").getItems(),v.byId("samplesList").getItems()),l=i.length,I;while(l--){I=i[l];if(I._getLinkSender){I._getLinkSender().setHref(I.getCustomData()[0].getValue());}}},_modelRefresh:function(){this.getModel().refresh();this._modifyLinks();},getGroupHeader:function(g){return new G({title:g.key,upperCase:false});},categoryAPIFormatter:function(c){return c==="API Reference";},categoryDocFormatter:function(c){return c==="Documentation";},categoryExploredFormatter:function(c){return c==="Samples";},onAllLoadMore:function(e){this.dataObject.visibleAllLength=e.getParameter("actual");this._modelRefresh();},onAPILoadMore:function(e){this.dataObject.visibleAPILength=e.getParameter("actual");this._modelRefresh();},onDocLoadMore:function(e){this.dataObject.visibleDocLength=e.getParameter("actual");this._modelRefresh();},onExploredLoadMore:function(e){this.dataObject.visibleExploredLength=e.getParameter("actual");this._modelRefresh();},onSwitchTab:function(e){var c=e.getParameter("section").data("category"),r={searchParam:this.getModel().getProperty("/searchTerm")};if(c){r["?options"]={category:c};}this.getRouter().navTo("search",r);}});});
